<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webserv - HTTP Server Audit Page</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <h1>üöÄ Webserv HTTP Server - Audit Testing Page</h1>
        
        <div class="success-note">
            <strong>‚úÖ Server Status:</strong> <span class="status-indicator status-ok"></span>Server is running and ready for audit testing!
        </div>

        <h2>üìã Quick Audit Checklist</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <h3>üåê Basic HTTP Methods</h3>
                <p>Test GET, POST, DELETE methods with proper status codes.</p>
                <a href="/" class="test-link"><span class="method-tag">GET</span>Homepage</a>
                <a href="/api" class="test-link"><span class="method-tag">GET</span>API Route</a>
                <div class="curl-example">curl -X POST -d "test" http://localhost:8080/api</div>
                <div class="curl-example">curl -X DELETE http://localhost:8080/api</div>
            </div>

            <div class="feature-card">
                <h3>üîÑ Redirections</h3>
                <p>Test HTTP redirections with proper 301/302 status codes.</p>
                <a href="/redirect" class="test-link">Test Redirect (301)</a>
                <div class="curl-example">curl -v http://localhost:8080/redirect</div>
            </div>

            <div class="feature-card">
                <h3>üìÅ Directory Listing</h3>
                <p>Test autoindex functionality and directory browsing.</p>
                <a href="/uploads" class="test-link">Browse Uploads Directory</a>
                <a href="/cgi-bin" class="test-link">Browse CGI Directory</a>
            </div>

            <div class="feature-card">
                <h3>üì§ File Upload</h3>
                <p>Test multipart/form-data file uploads.</p>
                <a href="/upload" class="test-link upload">Upload Interface</a>
                <div class="curl-example">curl -F "file=@test.txt" http://localhost:8080/upload</div>
            </div>
        </div>

        <h2>üêç CGI Testing</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <h3>‚úÖ Successful CGI</h3>
                <p>Test working Python CGI script execution.</p>
                <a href="/cgi-bin/test.py" class="test-link cgi"><span class="method-tag">GET</span>CGI Test Script</a>
                <div class="curl-example">curl -X POST -d "name=test" http://localhost:8080/cgi-bin/test.py</div>
            </div>

            <div class="feature-card">
                <h3>‚ùå Failed CGI</h3>
                <p>Test CGI error handling (script that exits with error).</p>
                <a href="/cgi-bin/fail.py" class="test-link cgi error">CGI Fail Script</a>
                <div class="curl-example">curl -v http://localhost:8080/cgi-bin/fail.py</div>
            </div>

            <div class="feature-card">
                <h3>üîÑ Chunked vs Unchunked</h3>
                <p>Test chunked transfer encoding support.</p>
                <a href="/chunked-demo" class="test-link">Chunked Response</a>
                <a href="/normal-demo" class="test-link">Normal Response</a>
                <div class="curl-example">curl -H "Transfer-Encoding: chunked" --data-binary @file.txt http://localhost:8080/cgi-bin/test.py</div>
            </div>
        </div>

        <h2>‚ö†Ô∏è Error Page Testing</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <h3>HTTP Error Codes</h3>
                <p>Test custom error pages for various HTTP status codes.</p>
                <a href="/nonexistent" class="test-link error">404 Not Found</a>
                <a href="/forbidden-test" class="test-link error">403 Forbidden</a>
                <div class="curl-example">curl -X PATCH http://localhost:8080/ # 405 Method Not Allowed</div>
                <div class="curl-example">curl -X POST -H "Content-Length: 999999999" http://localhost:8080/ # 413 Payload Too Large</div>
            </div>

            <div class="feature-card">
                <h3>Malformed Requests</h3>
                <p>Test server stability with invalid HTTP requests.</p>
                <div class="curl-example">printf 'BADMETHOD / HTTP/1.1\r\n\r\n' | nc localhost 8080</div>
                <div class="curl-example">printf 'GET /' | nc localhost 8080</div>
                <p><small>Server should return 400 Bad Request and stay running.</small></p>
            </div>
        </div>

        <h2>üç™ Cookies & Sessions</h2>
        <div class="feature-card">
            <h3>Session Management</h3>
            <p>Test cookie setting and session persistence.</p>
            <div class="curl-example">curl -i http://localhost:8080/ # Check Set-Cookie header</div>
            <div class="curl-example">curl -H "Cookie: SESSIONID=your_session_id" http://localhost:8080/</div>
            <p><small>Each request should maintain or create a session ID.</small></p>
        </div>

        <h2>üîß Configuration Testing</h2>
        <div class="audit-note">
            <strong>üìù For Auditors:</strong> 
            <ul>
                <li>Test multiple ports by modifying <code>config/webserv.conf</code></li>
                <li>Try invalid configurations to test error handling</li>
                <li>Test route-specific settings (methods, roots, etc.)</li>
                <li>Verify single epoll call per event loop (check source code)</li>
                <li>Test with <code>siege -b localhost:8080</code> for stress testing</li>
            </ul>
        </div>

        <h2>üìä Performance & Stress Testing</h2>
        <div class="code-block">
# Install siege if not available
sudo apt-get install siege

# Basic stress test
siege -b -c 10 -t 30s http://localhost:8080/

# File upload stress test
siege -b -c 5 -t 15s 'http://localhost:8080/upload POST &lt; test_file.txt'

# CGI stress test
siege -b -c 5 -t 15s http://localhost:8080/cgi-bin/test.py
        </div>

        <h2>üêõ Development & Debug Info</h2>
        <div class="feature-card">
            <h3>Server Information</h3>
            <p><strong>Server:</strong> Webserv/1.0 (Rust)</p>
            <p><strong>HTTP Version:</strong> HTTP/1.1</p>
            <p><strong>Architecture:</strong> Single-process, single-thread, epoll-based</p>
            <p><strong>Config File:</strong> <code>config/webserv.conf</code></p>
            <p><strong>Document Root:</strong> <code>./www</code></p>
            <p><strong>CGI Directory:</strong> <code>./www/cgi-bin</code></p>
            <p><strong>Upload Directory:</strong> <code>./www/uploads</code></p>
        </div>

        <div class="audit-note">
            <strong>üîç Audit Notes:</strong>
            <ul>
                <li>Error pages are served automatically on error conditions (not accessible via direct URLs)</li>
                <li>All I/O operations are non-blocking and use epoll</li>
                <li>Server handles malformed requests gracefully without crashing</li>
                <li>CGI scripts are executed in separate processes with proper environment variables</li>
                <li>File uploads support multipart/form-data encoding</li>
                <li>Session management uses secure random session IDs</li>
            </ul>
        </div>

        <div class="success-note">
            <strong>üìö Documentation:</strong> 
            For complete source code review, check:
            <ul>
                <li><code>src/server/mod.rs</code> - Main server logic and event loop</li>
                <li><code>src/http/</code> - HTTP request/response handling</li>
                <li><code>src/cgi/mod.rs</code> - CGI execution logic</li>
                <li><code>src/static_handler.rs</code> - Static file serving</li>
                <li><code>src/config/mod.rs</code> - Configuration parsing</li>
                <li><code>audit.md</code> - Detailed audit checklist</li>
            </ul>
        </div>
    </div>
</body>
</html>